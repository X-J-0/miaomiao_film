{"remainingRequest":"C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\src\\components\\City\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\src\\components\\City\\index.vue","mtime":1586598429861},{"path":"C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86183\\Desktop\\notebook\\vue学习\\vue电影项目\\miaomiao\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6J0NpdHknLA0KICBkYXRhKCl7DQogICAgcmV0dXJuIHsNCiAgICAgIGNpdHlMaXN0OltdLA0KICAgICAgaG90TGlzdDpbXSwNCiAgICAgIGlzTG9hZGluZzp0cnVlDQogICAgfQ0KICB9LA0KICBtb3VudGVkICgpIHsNCiAgICB2YXIgY2l0eUxpc3QgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NpdHlMaXN0Jyk7DQogICAgdmFyIGhvdExpc3QgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hvdExpc3QnKTsNCiAgICBpZihjaXR5TGlzdCAmJiBob3RMaXN0KXsNCiAgICAgIHRoaXMuY2l0eUxpc3QgPSBKU09OLnBhcnNlKGNpdHlMaXN0KTsNCiAgICAgIHRoaXMuaG90TGlzdCA9IEpTT04ucGFyc2UoaG90TGlzdCk7DQogICAgICB0aGlzLmlzTG9hZGluZz1mYWxzZTsNCiAgICB9DQogICAgdGhpcy5heGlvcy5nZXQoJy9hcGkvY2l0eUxpc3QnKS50aGVuKChyZXMpID0+IHsNCiAgICAgIHZhciBtc2cgPSByZXMuZGF0YS5tc2c7DQogICAgICBpZihtc2cgPT0gJ29rJykgew0KICAgICAgICB0aGlzLmlzTG9hZGluZz1mYWxzZTsNCiAgICAgICAgdmFyIGNpdGllcyA9IHJlcy5kYXRhLmRhdGEuY2l0aWVzOw0KICAgICAgICB2YXIge2NpdHlMaXN0LGhvdExpc3R9ID0gdGhpcy5mb3JtYXRDaXR5TGlzdChjaXRpZXMpOw0KICAgICAgICB0aGlzLmNpdHlMaXN0ID0gY2l0eUxpc3Q7DQogICAgICAgIHRoaXMuaG90TGlzdCA9IGhvdExpc3Q7DQogICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2l0eUxpc3QnLEpTT04uc3RyaW5naWZ5KGNpdHlMaXN0KSk7DQogICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaG90TGlzdCcsSlNPTi5zdHJpbmdpZnkoaG90TGlzdCkpOw0KICAgICAgfQ0KICAgIH0pDQogIH0sDQogIG1ldGhvZHM6ew0KICAgIGZvcm1hdENpdHlMaXN0KGNpdGllcyl7DQogICAgICB2YXIgY2l0eUxpc3QgPSBbXTsNCiAgICAgIHZhciBob3RMaXN0ID0gW107DQogICAgICBmb3IodmFyIGkgPSAwO2k8Y2l0aWVzLmxlbmd0aDtpKyspew0KICAgICAgICBpZihjaXRpZXNbaV0uaXNIb3QgPT09IDEpew0KICAgICAgICAgIGhvdExpc3QucHVzaChjaXRpZXNbaV0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBmb3IodmFyIGkgPSAwO2k8Y2l0aWVzLmxlbmd0aDtpKyspew0KICAgICAgICB2YXIgZmlyc3RMZXR0ZXIgPSBjaXRpZXNbaV0ucHkuc3Vic3RyaW5nKDAsMSkudG9VcHBlckNhc2UoKTsNCiAgICAgICAgaWYodG9Db20oZmlyc3RMZXR0ZXIpKXsgIC8v5paw5re75YqgaW5kZXgNCiAgICAgICAgICBjaXR5TGlzdC5wdXNoKHtpbmRleDpmaXJzdExldHRlcixsaXN0Olt7bm06Y2l0aWVzW2ldLm5tLGlkOmNpdGllc1tpXS5pZH1dfSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZXsgIC8v57Sv5Yqg5Yiw5bey5pyJaW5kZXjkuK0NCiAgICAgICAgICBmb3IodmFyIGogPSAwO2o8Y2l0eUxpc3QubGVuZ3RoO2orKyl7DQogICAgICAgICAgICBpZihjaXR5TGlzdFtqXS5pbmRleCA9PT0gZmlyc3RMZXR0ZXIpew0KICAgICAgICAgICAgICBjaXR5TGlzdFtqXS5saXN0LnB1c2goe25tOmNpdGllc1tpXS5ubSxpZDpjaXRpZXNbaV0uaWR9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGNpdHlMaXN0LnNvcnQoKG4xLG4yKT0+ew0KICAgICAgICBpZihuMS5pbmRleD5uMi5pbmRleCl7DQogICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZihuMS5pbmRleDxuMi5pbmRleCl7DQogICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgICAgZnVuY3Rpb24gdG9Db20oZmlyc3RMZXR0ZXIpew0KICAgICAgICBmb3IodmFyIGkgPSAwO2k8Y2l0eUxpc3QubGVuZ3RoO2krKyl7DQogICAgICAgICAgaWYoY2l0eUxpc3RbaV0uaW5kZXggPT0gZmlyc3RMZXR0ZXIpew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB7DQogICAgICAgIGNpdHlMaXN0LA0KICAgICAgICBob3RMaXN0DQogICAgICB9DQogICAgfSwNCiAgICBoYW5kbGVUb0luZGV4KGluZGV4KXsNCiAgICAgIHZhciBoMiA9IHRoaXMuJHJlZnMuY2l0eV9zb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoMicpOw0KICAgICAgdGhpcy4kcmVmcy5jaXR5X3NvcnQucGFyZW50Tm9kZS5zY3JvbGxUb3AgPSBoMltpbmRleF0ub2Zmc2V0VG9wOw0KICAgIH0sDQogICAgaGFuZGxlVG9DaXR5KG5tLGlkKXsNCiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnY2l0eS9DSVRZX0lORk8nLHtubSxpZH0pOw0KICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdub3dObScsbm0pOw0KICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdub3dJZCcsaWQpOw0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy9tb3ZpZS9ub3dQbGF5aW5nJyk7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/City","sourcesContent":["<template>\r\n  <div class=\"city_body\">\r\n    <!-- <div class=\"city_list\">\r\n      <div class=\"city_hot\">\r\n        <h2>热门城市</h2>\r\n        <ul class=\"clearfix\">\r\n          <li>上海</li>\r\n        </ul>\r\n      </div>\r\n      <div class=\"city_sort\">\r\n        <div>\r\n          <h2>A</h2>\r\n          <ul>\r\n            <li>阿拉善盟</li>\r\n            <li>鞍山</li>\r\n            <li>安庆</li>\r\n            <li>安阳</li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"city_index\">\r\n      <ul>\r\n        <li>A</li>\r\n        <li>B</li>\r\n        <li>C</li>\r\n        <li>D</li>\r\n        <li>E</li>\r\n      </ul>\r\n    </div> -->\r\n    <div class=\"city_list\">\r\n      <Loading v-if=\"isLoading\"/>\r\n        <div v-else class=\"city_hot\">\r\n        <h2>热门城市</h2>\r\n        <ul class=\"clearfix\">\r\n          <li v-for=\"item in hotList\" :key=\"item.id\" @click=\"handleToCity(item.nm,item.id)\">{{item.nm}}</li>\r\n        </ul>\r\n      </div>\r\n      <div class=\"city_sort\" ref=\"city_sort\">\r\n        <div v-for=\"item in cityList\" :key=\"item.index\">\r\n          <h2>{{item.index}}</h2>\r\n          <ul>\r\n            <li v-for=\"itemList in item.list\" :key=\"itemList.id\" @click=\"handleToCity(itemList.nm,itemList.id)\">{{itemList.nm}}</li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"city_index\">\r\n      <ul>\r\n        <li v-for=\"(item, index) in cityList\" :key=\"item.index\" @touchstart=\"handleToIndex(index)\">{{item.index}}</li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name:'City',\r\n  data(){\r\n    return {\r\n      cityList:[],\r\n      hotList:[],\r\n      isLoading:true\r\n    }\r\n  },\r\n  mounted () {\r\n    var cityList = window.localStorage.getItem('cityList');\r\n    var hotList = window.localStorage.getItem('hotList');\r\n    if(cityList && hotList){\r\n      this.cityList = JSON.parse(cityList);\r\n      this.hotList = JSON.parse(hotList);\r\n      this.isLoading=false;\r\n    }\r\n    this.axios.get('/api/cityList').then((res) => {\r\n      var msg = res.data.msg;\r\n      if(msg == 'ok') {\r\n        this.isLoading=false;\r\n        var cities = res.data.data.cities;\r\n        var {cityList,hotList} = this.formatCityList(cities);\r\n        this.cityList = cityList;\r\n        this.hotList = hotList;\r\n        window.localStorage.setItem('cityList',JSON.stringify(cityList));\r\n        window.localStorage.setItem('hotList',JSON.stringify(hotList));\r\n      }\r\n    })\r\n  },\r\n  methods:{\r\n    formatCityList(cities){\r\n      var cityList = [];\r\n      var hotList = [];\r\n      for(var i = 0;i<cities.length;i++){\r\n        if(cities[i].isHot === 1){\r\n          hotList.push(cities[i]);\r\n        }\r\n      }\r\n      for(var i = 0;i<cities.length;i++){\r\n        var firstLetter = cities[i].py.substring(0,1).toUpperCase();\r\n        if(toCom(firstLetter)){  //新添加index\r\n          cityList.push({index:firstLetter,list:[{nm:cities[i].nm,id:cities[i].id}]});\r\n        }\r\n        else{  //累加到已有index中\r\n          for(var j = 0;j<cityList.length;j++){\r\n            if(cityList[j].index === firstLetter){\r\n              cityList[j].list.push({nm:cities[i].nm,id:cities[i].id});\r\n            }\r\n          }\r\n        }\r\n      }\r\n      cityList.sort((n1,n2)=>{\r\n        if(n1.index>n2.index){\r\n          return 1;\r\n        }\r\n        else if(n1.index<n2.index){\r\n          return -1;\r\n        }\r\n        else{\r\n          return 0;\r\n        }\r\n      });\r\n      function toCom(firstLetter){\r\n        for(var i = 0;i<cityList.length;i++){\r\n          if(cityList[i].index == firstLetter){\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n      return {\r\n        cityList,\r\n        hotList\r\n      }\r\n    },\r\n    handleToIndex(index){\r\n      var h2 = this.$refs.city_sort.getElementsByTagName('h2');\r\n      this.$refs.city_sort.parentNode.scrollTop = h2[index].offsetTop;\r\n    },\r\n    handleToCity(nm,id){\r\n      this.$store.commit('city/CITY_INFO',{nm,id});\r\n      window.localStorage.setItem('nowNm',nm);\r\n      window.localStorage.setItem('nowId',id);\r\n      this.$router.push('/movie/nowPlaying');\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#content .city_body{margin-top:45px;display:flex;width:100%;position:absolute;top:0;bottom:0;}\r\n.city_body .city_list{flex:1;overflow:auto;background-color: #fff;}\r\n.city_body .city_list::webkit_scrollbar{\r\n  background-color: transparent;\r\n  width:0;\r\n}\r\n.city_body .city_hot{margin-top:20px;}\r\n.city_body .city_hot h2{padding-left:15px;line-height: 30px;font-size:14px;background-color: #fff;font-weight: normal;}\r\n/* .city_body .city_hot ul{} */\r\n.city_body .city_hot ul li{float:left;background-color: #fff;width:29%;height:33px;margin-top:15px;margin-left:3%;padding:0 4px;border:1px solid #e6e6e6}\r\n/* .city_body .city_sort{} */\r\n.city_body .city_sort div{margin-top:20px;}\r\n.city_body .city_sort h2{padding-left:15px;line-height: 30px;font-size:14px;background-color: #fff;font-weight: normal;}\r\n.city_body .city_sort ul{padding-left:10px;margin-top:10px;}\r\n.city_body .city_sort ul li{line-height: 30px;line-height: 30px;}\r\n.city_body .city_index{width:20px;display:flex;flex-direction: column;justify-content: center;text-align: center;border-left:1px #e6e6e6 solid}\r\n</style>\r\n"]}]}